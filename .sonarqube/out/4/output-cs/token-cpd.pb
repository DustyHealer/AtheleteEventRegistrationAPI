áP
hC:\Users\amazi\OneDrive\Documents\Personal\SBA\athlete-app-backend\UserAPI\Controllers\UserController.cs
	namespace 	
UserAPI
 
. 
Controllers 
{		 
[

 
Route

 

(


 
$str

 
)

 
]

 
[ 
ApiController 
] 
public 

class 
UserController 
:  !
ControllerBase" 0
{ 
private 
readonly 
IUserService %
service& -
;- .
private 
readonly "
ITokenGeneratorService /
tokenService0 <
;< =
public 
UserController 
( 
IUserService *
_service+ 3
,3 4"
ITokenGeneratorService5 K
_tokenServiceL Y
)Y Z
{ 	
service 
= 
_service 
; 
tokenService 
= 
_tokenService (
;( )
} 	
[ 	
HttpPost	 
( 
$str 
) 
] 
public 
IActionResult 
Register %
(% &
User& *
user+ /
)/ 0
{ 	
try 
{ 
return 
Ok 
( 
service !
.! "
Register" *
(* +
user+ /
)/ 0
)0 1
;1 2
} 
catch 
( &
UserAlreadyExistsException -
e. /
)/ 0
{ 
return 
Conflict 
(  
e  !
.! "
Message" )
)) *
;* +
}   
catch!! 
(!! 7
+PasswordAndConfirmPasswordMismatchException!! >
e!!? @
)!!@ A
{"" 
return## 

BadRequest## !
(##! "
e##" #
.### $
Message##$ +
)##+ ,
;##, -
}$$ 
catch%% 
(%% 
	Exception%% 
e%% 
)%% 
{&& 
return'' 

BadRequest'' !
(''! "
e''" #
.''# $
Message''$ +
)''+ ,
;'', -
}(( 
})) 	
[++ 	
HttpPost++	 
(++ 
$str++ 
)++ 
]++ 
public,, 
IActionResult,, 
Login,, "
(,," #
User,,# '
user,,( ,
),,, -
{-- 	
try.. 
{// 
var00 
usr00 
=00 
service00 !
.00! "
Login00" '
(00' (
user00( ,
)00, -
;00- .
return11 
Ok11 
(11 
tokenService11 &
.11& '
GenerateJWTToken11' 7
(117 8
usr118 ;
.11; <
Username11< D
,11D E
usr11F I
.11I J
Role11J N
)11N O
)11O P
;11P Q
}22 
catch33 
(33 !
UserNotFoundException33 (
e33) *
)33* +
{44 
return55 
NotFound55 
(55  
e55  !
.55! "
Message55" )
)55) *
;55* +
}66 
catch77 
(77 "
UserIdBlockedException77 )
e77* +
)77+ ,
{88 
return99 

BadRequest99 !
(99! "
e99" #
.99# $
Message99$ +
)99+ ,
;99, -
}:: 
catch;; 
(;; '
InvalidCredentialsException;; .
e;;/ 0
);;0 1
{<< 
return== 

StatusCode== !
(==! "
$num==" %
,==% &
e==' (
.==( )
Message==) 0
)==0 1
;==1 2
}>> 
catch?? 
(?? 
	Exception?? 
e?? 
)?? 
{@@ 
returnAA 

BadRequestAA !
(AA! "
eAA" #
.AA# $
MessageAA$ +
)AA+ ,
;AA, -
}BB 
}CC 	
[EE 	
HttpGetEE	 
(EE 
$strEE 
)EE 
]EE  
[FF 	
	AuthorizeFF	 
(FF 
RolesFF 
=FF 
$strFF '
)FF' (
]FF( )
publicGG 
IActionResultGG 
GetAllUsersGG (
(GG( )
)GG) *
{HH 	
tryII 
{JJ 
returnKK 
OkKK 
(KK 
serviceKK !
.KK! "
GetAllUsersKK" -
(KK- .
)KK. /
)KK/ 0
;KK0 1
}LL 
catchMM 
(MM 
	ExceptionMM 
eMM 
)MM 
{NN 
returnOO 

BadRequestOO !
(OO! "
eOO" #
.OO# $
MessageOO$ +
)OO+ ,
;OO, -
}PP 
}QQ 	
[SS 	
HttpGetSS	 
(SS 
$strSS #
)SS# $
]SS$ %
[TT 	
	AuthorizeTT	 
(TT 
RolesTT 
=TT 
$strTT '
)TT' (
]TT( )
publicUU 
IActionResultUU 
GetUserByIdUU (
(UU( )
intUU) ,
idUU- /
)UU/ 0
{VV 	
tryWW 
{XX 
returnYY 
OkYY 
(YY 
serviceYY !
.YY! "
GetUserByIdYY" -
(YY- .
idYY. 0
)YY0 1
)YY1 2
;YY2 3
}ZZ 
catch[[ 
([[ !
UserNotFoundException[[ (
e[[) *
)[[* +
{\\ 
return]] 
NotFound]] 
(]]  
e]]  !
.]]! "
Message]]" )
)]]) *
;]]* +
}^^ 
catch__ 
(__ 
	Exception__ 
e__ 
)__ 
{`` 
returnaa 

BadRequestaa !
(aa! "
eaa" #
.aa# $
Messageaa$ +
)aa+ ,
;aa, -
}bb 
}cc 	
[ee 	
HttpPutee	 
(ee 
$stree %
)ee% &
]ee& '
[ff 	
	Authorizeff	 
(ff 
Rolesff 
=ff 
$strff '
)ff' (
]ff( )
publicgg 
IActionResultgg 
UpdateUserPasswordgg /
(gg/ 0
Usergg0 4
usergg5 9
)gg9 :
{hh 	
tryii 
{jj 
returnkk 
Okkk 
(kk 
servicekk !
.kk! "
UpdateUserPasswordkk" 4
(kk4 5
userkk5 9
)kk9 :
)kk: ;
;kk; <
}ll 
catchmm 
(mm !
UserNotFoundExceptionmm (
emm) *
)mm* +
{nn 
returnoo 
NotFoundoo 
(oo  
eoo  !
.oo! "
Messageoo" )
)oo) *
;oo* +
}pp 
catchqq 
(qq 
	Exceptionqq 
eqq 
)qq 
{rr 
returnss 

BadRequestss !
(ss! "
ess" #
.ss# $
Messagess$ +
)ss+ ,
;ss, -
}tt 
}uu 	
[ww 	
HttpPutww	 
(ww 
$strww "
)ww" #
]ww# $
[xx 	
	Authorizexx	 
(xx 
Rolesxx 
=xx 
$strxx '
)xx' (
]xx( )
publicyy 
IActionResultyy 

UpdateUseryy '
(yy' (
intyy( +
idyy, .
,yy. /
Useryy0 4
useryy5 9
)yy9 :
{zz 	
try{{ 
{|| 
return}} 
Ok}} 
(}} 
service}} !
.}}! "

UpdateUser}}" ,
(}}, -
id}}- /
,}}/ 0
user}}1 5
)}}5 6
)}}6 7
;}}7 8
}~~ 
catch 
( !
UserNotFoundException (
e) *
)* +
{
ÄÄ 
return
ÅÅ 
NotFound
ÅÅ 
(
ÅÅ  
e
ÅÅ  !
.
ÅÅ! "
Message
ÅÅ" )
)
ÅÅ) *
;
ÅÅ* +
}
ÇÇ 
catch
ÉÉ 
(
ÉÉ 
	Exception
ÉÉ 
e
ÉÉ 
)
ÉÉ 
{
ÑÑ 
return
ÖÖ 

BadRequest
ÖÖ !
(
ÖÖ! "
e
ÖÖ" #
.
ÖÖ# $
Message
ÖÖ$ +
)
ÖÖ+ ,
;
ÖÖ, -
}
ÜÜ 
}
áá 	
[
ââ 	
HttpPut
ââ	 
(
ââ 
$str
ââ .
)
ââ. /
]
ââ/ 0
[
ää 	
	Authorize
ää	 
(
ää 
Roles
ää 
=
ää 
$str
ää "
)
ää" #
]
ää# $
public
ãã 
IActionResult
ãã 
BlockUserById
ãã *
(
ãã* +
int
ãã+ .
id
ãã/ 1
,
ãã1 2
string
ãã3 9
status
ãã: @
,
ãã@ A
User
ããB F
user
ããG K
)
ããK L
{
åå 	
try
çç 
{
éé 
return
èè 
Ok
èè 
(
èè 
service
èè !
.
èè! "
BlockUserById
èè" /
(
èè/ 0
id
èè0 2
,
èè2 3
status
èè4 :
)
èè: ;
)
èè; <
;
èè< =
}
êê 
catch
ëë 
(
ëë #
UserNotFoundException
ëë (
e
ëë) *
)
ëë* +
{
íí 
return
ìì 
NotFound
ìì 
(
ìì  
e
ìì  !
.
ìì! "
Message
ìì" )
)
ìì) *
;
ìì* +
}
îî 
catch
ïï 
(
ïï 
	Exception
ïï 
e
ïï 
)
ïï 
{
ññ 
return
óó 

BadRequest
óó !
(
óó! "
e
óó" #
.
óó# $
Message
óó$ +
)
óó+ ,
;
óó, -
}
òò 
}
ôô 	
}
õõ 
}úú Î
tC:\Users\amazi\OneDrive\Documents\Personal\SBA\athlete-app-backend\UserAPI\Exceptions\InvalidCredentialsException.cs
	namespace 	
UserAPI
 
. 

Exceptions 
{ 
public 

class '
InvalidCredentialsException ,
:- .
	Exception/ 8
{ 
public '
InvalidCredentialsException *
(* +
string+ 1
message2 9
)9 :
:; <
base= A
(A B
messageB I
)I J
{ 	
}

 	
} 
} ú
ÑC:\Users\amazi\OneDrive\Documents\Personal\SBA\athlete-app-backend\UserAPI\Exceptions\PasswordAndConfirmPasswordMismatchException.cs
	namespace 	
UserAPI
 
. 

Exceptions 
{ 
public 

class 7
+PasswordAndConfirmPasswordMismatchException <
:= >
	Exception? H
{		 
public

 7
+PasswordAndConfirmPasswordMismatchException

 :
(

: ;
string

; A
message

B I
)

I J
:

K L
base

M Q
(

Q R
message

R Y
)

Y Z
{ 	
} 	
} 
} Ë
sC:\Users\amazi\OneDrive\Documents\Personal\SBA\athlete-app-backend\UserAPI\Exceptions\UserAlreadyExistsException.cs
	namespace 	
UserAPI
 
. 

Exceptions 
{ 
public 

class &
UserAlreadyExistsException +
:, -
	Exception. 7
{ 
public &
UserAlreadyExistsException )
() *
string* 0
message1 8
)8 9
:: ;
base< @
(@ A
messageA H
)H I
{ 	
}

 	
} 
} ‹
oC:\Users\amazi\OneDrive\Documents\Personal\SBA\athlete-app-backend\UserAPI\Exceptions\UserIdBlockedException.cs
	namespace 	
UserAPI
 
. 

Exceptions 
{ 
public 

class "
UserIdBlockedException '
:( )
	Exception* 3
{		 
public

 "
UserIdBlockedException

 %
(

% &
string

& ,
message

- 4
)

4 5
:

6 7
base

8 <
(

< =
message

= D
)

D E
{ 	
} 	
} 
} Ÿ
nC:\Users\amazi\OneDrive\Documents\Personal\SBA\athlete-app-backend\UserAPI\Exceptions\UserNotFoundException.cs
	namespace 	
UserAPI
 
. 

Exceptions 
{ 
public 

class !
UserNotFoundException &
:' (
	Exception) 2
{ 
public !
UserNotFoundException $
($ %
string% +
message, 3
)3 4
:5 6
base7 ;
(; <
message< C
)C D
{ 	
}

 	
} 
} Õ
YC:\Users\amazi\OneDrive\Documents\Personal\SBA\athlete-app-backend\UserAPI\Models\User.cs
	namespace 	
UserAPI
 
. 
Models 
{ 
public 

class 
User 
{ 
[ 	
BsonId	 
] 
public		 
int		 
Id		 
{		 
get		 
;		 
set		  
;		  !
}		" #
public

 
string

 
EmailId

 
{

 
get

  #
;

# $
set

% (
;

( )
}

* +
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
ConfirmPassword %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 
string 
Role 
{ 
get  
;  !
set" %
;% &
}' (
=) *
$str+ 1
;1 2
public 
string 
CountryCode !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
CountryName !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
DialCode 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Phonenumber !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
Status 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
$str- 5
;5 6
public 
DateTime 
Date 
{ 
get "
;" #
set$ '
;' (
}) *
=+ ,
DateTime- 5
.5 6
Now6 9
;9 :
} 
} Ê

`C:\Users\amazi\OneDrive\Documents\Personal\SBA\athlete-app-backend\UserAPI\Models\UserContext.cs
	namespace 	
UserAPI
 
. 
Models 
{ 
public 

class 
UserContext 
{		 
MongoClient

 
client

 
;

 
IMongoDatabase 
db 
; 
public 
UserContext 
( 
IConfiguration )
configuration* 7
)7 8
{ 	
client 
= 
new 
MongoClient $
($ %
Environment% 0
.0 1"
GetEnvironmentVariable1 G
(G H
$strH \
)\ ]
)] ^
;^ _
db 
= 
client 
. 
GetDatabase #
(# $
Environment$ /
./ 0"
GetEnvironmentVariable0 F
(F G
$strG U
)U V
)V W
;W X
} 	
public 
IMongoCollection 
<  
User  $
>$ %
Users& +
=>, .
db/ 1
.1 2
GetCollection2 ?
<? @
User@ D
>D E
(E F
$strF M
)M N
;N O
} 
} ™

UC:\Users\amazi\OneDrive\Documents\Personal\SBA\athlete-app-backend\UserAPI\Program.cs
	namespace

 	
UserAPI


 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} ì
hC:\Users\amazi\OneDrive\Documents\Personal\SBA\athlete-app-backend\UserAPI\Repository\IUserRepository.cs
	namespace 	
UserAPI
 
. 

Repository 
{ 
public 

	interface 
IUserRepository $
{ 
User 
Register 
( 
User 
user 
)  
;  !
User		 
Login		 
(		 
User		 
user		 
)		 
;		 
List

 
<

 
User

 
>

 
GetAllUsers

 
(

 
)

  
;

  !
User 
GetUserById 
( 
int 
id 
)  
;  !
User 
GetUserByUsername 
( 
string %
username& .
). /
;/ 0
bool 
UpdateUserPassword 
(  
User  $
user% )
)) *
;* +
bool 

UpdateUser 
( 
int 
id 
, 
User  $
user% )
)) *
;* +
bool 
BlockUserById 
( 
int 
id !
,! "
string# )
status* 0
)0 1
;1 2
} 
} ÷V
gC:\Users\amazi\OneDrive\Documents\Personal\SBA\athlete-app-backend\UserAPI\Repository\UserRepository.cs
	namespace 	
UserAPI
 
. 

Repository 
{ 
public 

class 
UserRepository 
:  !
IUserRepository" 1
{		 
private

 
readonly

 
UserContext

 $
context

% ,
;

, -
public 
UserRepository 
( 
UserContext )
_context* 2
)2 3
{ 	
context 
= 
_context 
; 
} 	
public 
bool 
BlockUserById !
(! "
int" %
id& (
,( )
string* 0
status1 7
)7 8
{ 	
var 
user 
= 
GetUserById "
(" #
id# %
)% &
;& '
if 
( 
user 
!= 
null 
) 
{ 
var 
filter 
= 
Builders %
<% &
User& *
>* +
.+ ,
Filter, 2
.2 3
Where3 8
(8 9
x9 :
=>; =
x> ?
.? @
Id@ B
.B C
EqualsC I
(I J
idJ L
)L M
)M N
;N O
var 
update 
= 
Builders %
<% &
User& *
>* +
.+ ,
Update, 2
.2 3
Set3 6
(6 7
x7 8
=>9 ;
x< =
.= >
Status> D
,D E
statusF L
)L M
;M N
context 
. 
Users 
. 
	UpdateOne '
(' (
filter( .
,. /
update0 6
)6 7
;7 8
return 
true 
; 
} 
return 
false 
; 
} 	
public 
List 
< 
User 
> 
GetAllUsers %
(% &
)& '
{ 	
return 
context 
. 
Users  
.  !
Find! %
(% &
x& '
=>( *
true+ /
)/ 0
.0 1
ToList1 7
(7 8
)8 9
;9 :
}   	
public"" 
User"" 
GetUserById"" 
(""  
int""  #
id""$ &
)""& '
{## 	
return$$ 
context$$ 
.$$ 
Users$$  
.$$  !
Find$$! %
($$% &
x$$& '
=>$$( *
x$$+ ,
.$$, -
Id$$- /
.$$/ 0
Equals$$0 6
($$6 7
id$$7 9
)$$9 :
)$$: ;
.$$; <
FirstOrDefault$$< J
($$J K
)$$K L
;$$L M
}%% 	
public'' 
User'' 
GetUserByUsername'' %
(''% &
string''& ,
username''- 5
)''5 6
{(( 	
return)) 
context)) 
.)) 
Users))  
.))  !
Find))! %
())% &
x))& '
=>))( *
x))+ ,
.)), -
Username))- 5
.))5 6
Equals))6 <
())< =
username))= E
)))E F
)))F G
.))G H
FirstOrDefault))H V
())V W
)))W X
;))X Y
}** 	
public,, 
User,, 
Login,, 
(,, 
User,, 
user,, #
),,# $
{-- 	
return.. 
context.. 
... 
Users..  
...  !
Find..! %
(..% &
x..& '
=>..( *
x..+ ,
..., -
Username..- 5
...5 6
Equals..6 <
(..< =
user..= A
...A B
Username..B J
)..J K
&&..L N
x..O P
...P Q
Password..Q Y
...Y Z
Equals..Z `
(..` a
user..a e
...e f
Password..f n
)..n o
)..o p
...p q
FirstOrDefault..q 
(	.. Ä
)
..Ä Å
;
..Å Ç
}// 	
public11 
User11 
Register11 
(11 
User11 !
user11" &
)11& '
{22 	
var33 
res33 
=33 
context33 
.33 
Users33 #
.33# $
Find33$ (
(33( )
x33) *
=>33+ -
x33. /
.33/ 0
Id330 2
.332 3
Equals333 9
(339 :
user33: >
.33> ?
Id33? A
)33A B
)33B C
.33C D
FirstOrDefault33D R
(33R S
)33S T
;33T U
if44 
(44 
res44 
==44 
null44 
)44 
{55 
var66 
topUser66 
=66 
context66 %
.66% &
Users66& +
.66+ ,
Find66, 0
(660 1
x661 2
=>663 5
true666 :
)66: ;
.66; <
SortByDescending66< L
(66L M
x66M N
=>66O Q
x66R S
.66S T
Id66T V
)66V W
.66W X
FirstOrDefault66X f
(66f g
)66g h
;66h i
if77 
(77 
topUser77 
==77 
null77 #
)77# $
{88 
user99 
.99 
Id99 
=99 
$num99 "
;99" #
}:: 
else;; 
{<< 
user== 
.== 
Id== 
=== 
topUser== %
.==% &
Id==& (
+==) *
$num==+ ,
;==, -
}>> 
context?? 
.?? 
Users?? 
.?? 
	InsertOne?? '
(??' (
user??( ,
)??, -
;??- .
return@@ 
user@@ 
;@@ 
}AA 
returnBB 
nullBB 
;BB 
}CC 	
publicEE 
boolEE 

UpdateUserEE 
(EE 
intEE "
idEE# %
,EE% &
UserEE' +
userEE, 0
)EE0 1
{FF 	
varGG 
usrGG 
=GG 
GetUserByIdGG !
(GG! "
userGG" &
.GG& '
IdGG' )
)GG) *
;GG* +
ifHH 
(HH 
usrHH 
!=HH 
nullHH 
)HH 
{II 
varJJ 
filterJJ 
=JJ 
BuildersJJ %
<JJ% &
UserJJ& *
>JJ* +
.JJ+ ,
FilterJJ, 2
.JJ2 3
WhereJJ3 8
(JJ8 9
xJJ9 :
=>JJ; =
xJJ> ?
.JJ? @
IdJJ@ B
.JJB C
EqualsJJC I
(JJI J
idJJJ L
)JJL M
)JJM N
;JJN O
varKK 
updateKK 
=KK 
BuildersKK %
<KK% &
UserKK& *
>KK* +
.KK+ ,
UpdateKK, 2
.KK2 3
SetKK3 6
(KK6 7
xKK7 8
=>KK9 ;
xKK< =
.KK= >
UsernameKK> F
,KKF G
userKKH L
.KKL M
UsernameKKM U
)KKU V
.LL  !
SetLL! $
(LL$ %
xLL% &
=>LL' )
xLL* +
.LL+ ,
EmailIdLL, 3
,LL3 4
userLL5 9
.LL9 :
EmailIdLL: A
)LLA B
.MM  !
SetMM! $
(MM$ %
xMM% &
=>MM' )
xMM* +
.MM+ ,
RoleMM, 0
,MM0 1
userMM2 6
.MM6 7
RoleMM7 ;
)MM; <
.NN  !
SetNN! $
(NN$ %
xNN% &
=>NN' )
xNN* +
.NN+ ,
CountryCodeNN, 7
,NN7 8
userNN9 =
.NN= >
CountryCodeNN> I
)NNI J
.OO  !
SetOO! $
(OO$ %
xOO% &
=>OO' )
xOO* +
.OO+ ,
CountryNameOO, 7
,OO7 8
userOO9 =
.OO= >
CountryNameOO> I
)OOI J
.PP  !
SetPP! $
(PP$ %
xPP% &
=>PP' )
xPP* +
.PP+ ,
DialCodePP, 4
,PP4 5
userPP6 :
.PP: ;
DialCodePP; C
)PPC D
.QQ  !
SetQQ! $
(QQ$ %
xQQ% &
=>QQ' )
xQQ* +
.QQ+ ,
PhonenumberQQ, 7
,QQ7 8
userQQ9 =
.QQ= >
PhonenumberQQ> I
)QQI J
;QQJ K
contextRR 
.RR 
UsersRR 
.RR 
	UpdateOneRR '
(RR' (
filterRR( .
,RR. /
updateRR0 6
)RR6 7
;RR7 8
returnSS 
trueSS 
;SS 
}TT 
returnUU 
falseUU 
;UU 
}VV 	
publicXX 
boolXX 
UpdateUserPasswordXX &
(XX& '
UserXX' +
userXX, 0
)XX0 1
{YY 	
varZZ 
usrZZ 
=ZZ 
GetUserByIdZZ !
(ZZ! "
userZZ" &
.ZZ& '
IdZZ' )
)ZZ) *
;ZZ* +
if[[ 
([[ 
usr[[ 
!=[[ 
null[[ 
)[[ 
{\\ 
var]] 
filter]] 
=]] 
Builders]] %
<]]% &
User]]& *
>]]* +
.]]+ ,
Filter]], 2
.]]2 3
Where]]3 8
(]]8 9
x]]9 :
=>]]; =
x]]> ?
.]]? @
Id]]@ B
.]]B C
Equals]]C I
(]]I J
user]]J N
.]]N O
Id]]O Q
)]]Q R
)]]R S
;]]S T
var^^ 
update^^ 
=^^ 
Builders^^ %
<^^% &
User^^& *
>^^* +
.^^+ ,
Update^^, 2
.^^2 3
Set^^3 6
(^^6 7
x^^7 8
=>^^9 ;
x^^< =
.^^= >
Password^^> F
,^^F G
user^^H L
.^^L M
Password^^M U
)^^U V
.__  !
Set__! $
(__$ %
x__% &
=>__& (
x__( )
.__) *
ConfirmPassword__* 9
,__9 :
user__; ?
.__? @
Password__@ H
)__H I
;__I J
context`` 
.`` 
Users`` 
.`` 
	UpdateOne`` '
(``' (
filter``( .
,``. /
update``0 6
)``6 7
;``7 8
returnaa 
trueaa 
;aa 
}bb 
returncc 
falsecc 
;cc 
}dd 	
}ee 
}ff ç&
fC:\Users\amazi\OneDrive\Documents\Personal\SBA\athlete-app-backend\UserAPI\ServiceRegistryExtension.cs
	namespace		 	
UserAPI		
 
{

 
public 

static 
class $
ServiceRegistryExtension 0
{ 
public 
static 
IServiceCollection (
AddConsulConfig) 8
(8 9
this9 =
IServiceCollection> P
servicesQ Y
,Y Z
IConfiguration[ i!
configurationSettingsj 
)	 Ä
{ 	
services 
. 
AddSingleton !
<! "
IConsulClient" /
,/ 0
ConsulClient1 =
>= >
(> ?
p? @
=>A C
newD G
ConsulClientH T
(T U
consulConfigU a
=>b d
{ 
consulConfig 
. 
Address $
=% &
new' *
Uri+ .
(. /
Environment/ :
.: ;"
GetEnvironmentVariable; Q
(Q R
$strR a
)a b
)b c
;c d
} 
) 
) 
; 
return 
services 
; 
} 	
public 
static 
IApplicationBuilder )
	UseConsul* 3
(3 4
this4 8
IApplicationBuilder9 L
appM P
,P Q
IConfigurationR `!
configirationSettingsa v
)v w
{ 	
var 
consulClient 
= 
app "
." #
ApplicationServices# 6
.6 7
GetRequiredService7 I
<I J
IConsulClientJ W
>W X
(X Y
)Y Z
;Z [
var 
logger 
= 
app 
. 
ApplicationServices 0
.0 1
GetRequiredService1 C
<C D
ILoggerFactoryD R
>R S
(S T
)T U
.U V
CreateLoggerV b
(b c
$strc q
)q r
;r s
var 
lifetime 
= 
app 
. 
ApplicationServices 2
.2 3
GetRequiredService3 E
<E F$
IHostApplicationLifetimeF ^
>^ _
(_ `
)` a
;a b
var 
registration 
= 
new "$
AgentServiceRegistration# ;
(; <
)< =
{ 
ID## 
=## 
Environment##  
.##  !"
GetEnvironmentVariable##! 7
(##7 8
$str##8 K
)##K L
,##L M
Name$$ 
=$$ 
Environment$$ "
.$$" #"
GetEnvironmentVariable$$# 9
($$9 :
$str$$: M
)$$M N
,$$N O
Address%% 
=%% 
Environment%% %
.%%% &"
GetEnvironmentVariable%%& <
(%%< =
$str%%= P
)%%P Q
,%%Q R
Port&& 
=&& 
int&& 
.&& 
Parse&&  
(&&  !
Environment&&! ,
.&&, -"
GetEnvironmentVariable&&- C
(&&C D
$str&&D W
)&&W X
)&&X Y
}(( 
;(( 
logger** 
.** 
LogInformation** !
(**! "
$str**" ;
)**; <
;**< =
consulClient++ 
.++ 
Agent++ 
.++ 
ServiceDeregister++ 0
(++0 1
registration++1 =
.++= >
ID++> @
)++@ A
.++A B
ConfigureAwait++B P
(++P Q
true++Q U
)++U V
;++V W
consulClient,, 
.,, 
Agent,, 
.,, 
ServiceRegister,, .
(,,. /
registration,,/ ;
),,; <
.,,< =
ConfigureAwait,,= K
(,,K L
true,,L P
),,P Q
;,,Q R
lifetime.. 
... 
ApplicationStopped.. '
...' (
Register..( 0
(..0 1
(..1 2
)..2 3
=>..4 6
{// 
logger00 
.00 
LogInformation00 %
(00% &
$str00& G
)00G H
;00H I
consulClient11 
.11 
Agent11 "
.11" #
ServiceDeregister11# 4
(114 5
registration115 A
.11A B
ID11B D
)11D E
.11E F
ConfigureAwait11F T
(11T U
true11U Y
)11Y Z
;11Z [
}22 
)22 
;22 
return44 
app44 
;44 
}55 	
}66 
}77 Å
lC:\Users\amazi\OneDrive\Documents\Personal\SBA\athlete-app-backend\UserAPI\Service\ITokenGeneratorService.cs
	namespace 	
UserAPI
 
. 
Service 
{ 
public 

	interface "
ITokenGeneratorService +
{		 
string

 
GenerateJWTToken

 
(

  
string

  &
username

' /
,

/ 0
string

1 7
role

8 <
)

< =
;

= >
} 
} ˇ	
bC:\Users\amazi\OneDrive\Documents\Personal\SBA\athlete-app-backend\UserAPI\Service\IUserService.cs
	namespace 	
UserAPI
 
. 
Service 
{ 
public 

	interface 
IUserService !
{ 
User 
Register 
( 
User 
user 
)  
;  !
User		 
Login		 
(		 
User		 
user		 
)		 
;		 
List

 
<

 
User

 
>

 
GetAllUsers

 
(

 
)

  
;

  !
User 
GetUserById 
( 
int 
id 
)  
;  !
bool 
UpdateUserPassword 
(  
User  $
user% )
)) *
;* +
bool 

UpdateUser 
( 
int 
id 
, 
User  $
user% )
)) *
;* +
bool 
BlockUserById 
( 
int 
id !
,! "
string# )
status* 0
)0 1
;1 2
} 
} ¸
kC:\Users\amazi\OneDrive\Documents\Personal\SBA\athlete-app-backend\UserAPI\Service\TokenGeneratorService.cs
	namespace 	
UserAPI
 
. 
Service 
{ 
public 

class !
TokenGeneratorService &
:' ("
ITokenGeneratorService) ?
{ 
public 
string 
GenerateJWTToken &
(& '
string' -
username. 6
,6 7
string8 >
role? C
)C D
{ 	
var 
claims 
= 
new 
[ 
] 
{ 
new 
Claim 
( 
$str $
,$ %
username& .
). /
,/ 0
new 
Claim 
( 
$str  
,  !
role" &
)& '
} 
; 
var 
key 
= 
new  
SymmetricSecurityKey .
(. /
Encoding/ 7
.7 8
UTF88 <
.< =
GetBytes= E
(E F
$strF c
)c d
)d e
;e f
var 
creds 
= 
new 
SigningCredentials .
(. /
key/ 2
,2 3
SecurityAlgorithms4 F
.F G

HmacSha256G Q
)Q R
;R S
var 
token 
= 
new 
JwtSecurityToken ,
(, -
issuer 
: 
$str %
,% &
audience 
: 
$str *
,* +
claims 
: 
claims "
," #
expires 
: 
DateTime %
.% &
Now& )
.) *

AddMinutes* 4
(4 5
$num5 7
)7 8
,8 9
signingCredentials &
:& '
creds( -
) 
; 
var 
response 
= 
new 
{  
username! )
=* +
username, 4
,4 5
token6 ;
=< =
new> A#
JwtSecurityTokenHandlerB Y
(Y Z
)Z [
.[ \

WriteToken\ f
(f g
tokeng l
)l m
}n o
;o p
return   
JsonConvert   
.   
SerializeObject   .
(  . /
response  / 7
)  7 8
;  8 9
}!! 	
}"" 
}## ‘?
aC:\Users\amazi\OneDrive\Documents\Personal\SBA\athlete-app-backend\UserAPI\Service\UserService.cs
	namespace 	
UserAPI
 
. 
Service 
{ 
public 

class 
UserService 
: 
IUserService +
{		 
private

 
readonly

 
IUserRepository

 (
repo

) -
;

- .
public 
UserService 
( 
IUserRepository *
_repo+ 0
)0 1
{ 	
repo 
= 
_repo 
; 
} 	
public 
bool 
BlockUserById !
(! "
int" %
id& (
,( )
string* 0
status1 7
)7 8
{ 	
var 
usr 
= 
repo 
. 
GetUserById &
(& '
id' )
)) *
;* +
if 
( 
usr 
== 
null 
) 
throw 
new !
UserNotFoundException /
(/ 0
$"0 2
$str2 @
{@ A
idA C
}C D
$strD T
"T U
)U V
;V W
return 
repo 
. 
BlockUserById %
(% &
id& (
,( )
status* 0
)0 1
;1 2
} 	
public 
List 
< 
User 
> 
GetAllUsers %
(% &
)& '
{ 	
return 
repo 
. 
GetAllUsers #
(# $
)$ %
;% &
} 	
public 
User 
GetUserById 
(  
int  #
id$ &
)& '
{ 	
var 
usr 
= 
repo 
. 
GetUserById &
(& '
id' )
)) *
;* +
if 
( 
usr 
== 
null 
) 
{   
throw!! 
new!! !
UserNotFoundException!! /
(!!/ 0
$"!!0 2
$str!!2 @
{!!@ A
id!!A C
}!!C D
$str!!D T
"!!T U
)!!U V
;!!V W
}"" 
return## 
usr## 
;## 
}$$ 	
public&& 
User&& 
Login&& 
(&& 
User&& 
user&& #
)&&# $
{'' 	
var(( 
usr(( 
=(( 
repo(( 
.(( 
GetUserByUsername(( ,
(((, -
user((- 1
.((1 2
Username((2 :
)((: ;
;((; <
if)) 
()) 
usr)) 
==)) 
null)) 
))) 
{** 
throw++ 
new++ !
UserNotFoundException++ /
(++/ 0
$"++0 2
$str++2 F
{++F G
user++G K
.++K L
Username++L T
}++T U
$str++U e
"++e f
)++f g
;++g h
},, 
if-- 
(-- 
usr-- 
.-- 
Status-- 
.-- 
ToLower-- "
(--" #
)--# $
.--$ %
Equals--% +
(--+ ,
$str--, 5
)--5 6
)--6 7
{.. 
throw// 
new// "
UserIdBlockedException// 0
(//0 1
$"//1 3
$str//3 G
{//G H
user//H L
.//L M
Username//M U
}//U V
$str//V a
"//a b
)//b c
;//c d
}00 
var11 
res11 
=11 
repo11 
.11 
Login11  
(11  !
user11! %
)11% &
;11& '
if22 
(22 
res22 
==22 
null22 
)22 
{33 
throw44 
new44 '
InvalidCredentialsException44 5
(445 6
$str446 T
)44T U
;44U V
}55 
return66 
res66 
;66 
}77 	
public99 
User99 
Register99 
(99 
User99 !
user99" &
)99& '
{:: 	
var;; 
usr;; 
=;; 
repo;; 
.;; 
GetUserById;; &
(;;& '
user;;' +
.;;+ ,
Id;;, .
);;. /
;;;/ 0
if<< 
(<< 
usr<< 
!=<< 
null<< 
)<< 
{== 
throw>> 
new>> &
UserAlreadyExistsException>> 4
(>>4 5
$">>5 7
$str>>7 E
{>>E F
user>>F J
.>>J K
Id>>K M
}>>M N
$str>>N ]
">>] ^
)>>^ _
;>>_ `
}?? 
if@@ 
(@@ 
!@@ 
user@@ 
.@@ 
Password@@ 
.@@ 
Equals@@ %
(@@% &
user@@& *
.@@* +
ConfirmPassword@@+ :
)@@: ;
)@@; <
{AA 
throwBB 
newBB 7
+PasswordAndConfirmPasswordMismatchExceptionBB E
(BBE F
$"BBF H
$strBBH {
{BB{ |
user	BB| Ä
.
BBÄ Å
Id
BBÅ É
}
BBÉ Ñ
"
BBÑ Ö
)
BBÖ Ü
;
BBÜ á
}CC 
returnDD 
repoDD 
.DD 
RegisterDD  
(DD  !
userDD! %
)DD% &
;DD& '
}EE 	
publicGG 
boolGG 

UpdateUserGG 
(GG 
intGG "
idGG# %
,GG% &
UserGG' +
userGG, 0
)GG0 1
{HH 	
varII 
usrII 
=II 
repoII 
.II 
GetUserByIdII &
(II& '
idII' )
)II) *
;II* +
ifJJ 
(JJ 
usrJJ 
==JJ 
nullJJ 
)JJ 
{KK 
throwLL 
newLL !
UserNotFoundExceptionLL /
(LL/ 0
$"LL0 2
$strLL2 @
{LL@ A
idLLA C
}LLC D
$strLLD T
"LLT U
)LLU V
;LLV W
}MM 
ifNN 
(NN 
usrNN 
.NN 
StatusNN 
.NN 
ToLowerNN "
(NN" #
)NN# $
.NN$ %
EqualsNN% +
(NN+ ,
$strNN, 5
)NN5 6
)NN6 7
{OO 
throwPP 
newPP "
UserIdBlockedExceptionPP 0
(PP0 1
$"PP1 3
$strPP3 A
{PPA B
userPPB F
.PPF G
IdPPG I
}PPI J
$strPPJ U
"PPU V
)PPV W
;PPW X
}QQ 
returnRR 
repoRR 
.RR 

UpdateUserRR "
(RR" #
idRR# %
,RR% &
userRR' +
)RR+ ,
;RR, -
}SS 	
publicUU 
boolUU 
UpdateUserPasswordUU &
(UU& '
UserUU' +
userUU, 0
)UU0 1
{VV 	
varWW 
usrWW 
=WW 
repoWW 
.WW 
GetUserByIdWW &
(WW& '
userWW' +
.WW+ ,
IdWW, .
)WW. /
;WW/ 0
ifXX 
(XX 
usrXX 
==XX 
nullXX 
)XX 
{YY 
throwZZ 
newZZ !
UserNotFoundExceptionZZ /
(ZZ/ 0
$"ZZ0 2
$strZZ2 @
{ZZ@ A
userZZA E
.ZZE F
IdZZF H
}ZZH I
$strZZI Y
"ZZY Z
)ZZZ [
;ZZ[ \
}[[ 
return\\ 
repo\\ 
.\\ 
UpdateUserPassword\\ *
(\\* +
user\\+ /
)\\/ 0
;\\0 1
}]] 	
}^^ 
}__ ﬂ.
UC:\Users\amazi\OneDrive\Documents\Personal\SBA\athlete-app-backend\UserAPI\Startup.cs
	namespace 	
UserAPI
 
{ 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public!! 
void!! 
ConfigureServices!! %
(!!% &
IServiceCollection!!& 8
services!!9 A
)!!A B
{"" 	
services## 
.## 
AddConsulConfig## $
(##$ %
Configuration##% 2
)##2 3
;##3 4
services$$ 
.$$ 
AddControllers$$ #
($$# $
)$$$ %
.$$% &
AddNewtonsoftJson$$& 7
($$7 8
)$$8 9
;$$9 :
services'' 
.'' 
	AddScoped'' 
<'' 
UserContext'' *
>''* +
(''+ ,
)'', -
;''- .
services(( 
.(( 
	AddScoped(( 
<(( 
IUserRepository(( .
,((. /
UserRepository((0 >
>((> ?
(((? @
)((@ A
;((A B
services)) 
.)) 
	AddScoped)) 
<)) 
IUserService)) +
,))+ ,
UserService))- 8
>))8 9
())9 :
))): ;
;)); <
services** 
.** 
	AddScoped** 
<** "
ITokenGeneratorService** 5
,**5 6!
TokenGeneratorService**7 L
>**L M
(**M N
)**N O
;**O P
services-- 
.-- 
AddCors-- 
(-- 
options-- $
=>--% '
options--( /
.--/ 0
	AddPolicy--0 9
(--9 :
$str--: J
,--J K
policy--L R
=>--S U
policy--V \
.--\ ]
AllowAnyOrigin--] k
(--k l
)--l m
.--m n
AllowAnyHeader--n |
(--| }
)--} ~
.--~ 
AllowAnyMethod	-- ç
(
--ç é
)
--é è
)
--è ê
)
--ê ë
;
--ë í
var11 
key11 
=11 
new11  
SymmetricSecurityKey11 .
(11. /
Encoding11/ 7
.117 8
UTF8118 <
.11< =
GetBytes11= E
(11E F
$str11F c
)11c d
)11d e
;11e f
services22 
.22 
AddAuthentication22 &
(22& '
options22' .
=>22/ 1
{33 
options44 
.44 %
DefaultAuthenticateScheme44 1
=442 3
JwtBearerDefaults444 E
.44E F 
AuthenticationScheme44F Z
;44Z [
options55 
.55 "
DefaultChallengeScheme55 .
=55/ 0
JwtBearerDefaults551 B
.55B C 
AuthenticationScheme55C W
;55W X
}66 
)66 
.66 
AddJwtBearer66 
(66 
o66 
=>66  
o66! "
.66" #%
TokenValidationParameters66# <
=66= >
new66? B%
TokenValidationParameters66C \
(66\ ]
)66] ^
{77 $
ValidateIssuerSigningKey88 (
=88) *
true88+ /
,88/ 0
IssuerSigningKey99  
=99! "
key99# &
,99& '
ValidateIssuer;; 
=;;  
true;;! %
,;;% &
ValidIssuer<< 
=<< 
$str<< '
,<<' (
ValidateAudience>>  
=>>! "
true>># '
,>>' (
ValidAudience?? 
=?? 
$str??  ,
}@@ 
)@@ 
;@@ 
servicesCC 
.CC 
AddSwaggerGenCC "
(CC" #
)CC# $
;CC$ %
}FF 	
publicII 
voidII 
	ConfigureII 
(II 
IApplicationBuilderII 1
appII2 5
,II5 6
IWebHostEnvironmentII7 J
envIIK N
)IIN O
{JJ 	
ifKK 
(KK 
envKK 
.KK 
IsDevelopmentKK !
(KK! "
)KK" #
)KK# $
{LL 
appMM 
.MM %
UseDeveloperExceptionPageMM -
(MM- .
)MM. /
;MM/ 0
}NN 
appPP 
.PP 
UseHttpsRedirectionPP #
(PP# $
)PP$ %
;PP% &
appRR 
.RR 
	UseConsulRR 
(RR 
ConfigurationRR '
)RR' (
;RR( )
appTT 
.TT 
UseCorsTT 
(TT 
$strTT (
)TT( )
;TT) *
appVV 
.VV 

UseSwaggerVV 
(VV 
)VV 
;VV 
appXX 
.XX 
UseSwaggerUIXX 
(XX 
optionsXX $
=>XX% '
optionsXX( /
.XX/ 0
SwaggerEndpointXX0 ?
(XX? @
$strXX@ Z
,XXZ [
$strXX\ h
)XXh i
)XXi j
;XXj k
appZZ 
.ZZ 

UseRoutingZZ 
(ZZ 
)ZZ 
;ZZ 
app\\ 
.\\ 
UseAuthentication\\ !
(\\! "
)\\" #
.\\# $
UseAuthorization\\$ 4
(\\4 5
)\\5 6
;\\6 7
app^^ 
.^^ 
UseEndpoints^^ 
(^^ 
	endpoints^^ &
=>^^' )
{__ 
	endpoints`` 
.`` 
MapControllers`` (
(``( )
)``) *
;``* +
}aa 
)aa 
;aa 
}bb 	
}cc 
}dd 